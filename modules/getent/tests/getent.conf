@version: 3.5

@define include-path "`include-path`:`scldir`"
@include "tests/incubator-scl.conf"

test/template-function(
  module("getent")
  subject("error.none")
  description("$$(getent) fails with an unkown service")
  template("$(getent whatever 80)")
);

test/template-function(
  module("getent")
  subject("error.arg-mismatch")
  description("$$(getent) fails when argument numbers mismatch")
  template("$(getent services) $(getent services http 80 0 0 0)")
);

test/template-function(
  module("getent")
  subject("services")
  description("$$(getent services) works")
  template("$(getent services 80) $(getent services http)")
);

test/template-function(
  module("getent")
  subject("services.fail")
  description("$$(getent services) fails with an unknown service")
  template("$(getent services this-does-not-exist)")
);

test/template-function(
  module("getent")
  subject("passwd")
  description("$$(getent passwd) works")
  template("$(getent passwd 0) $(getent passwd root) $(getent passwd 0 uid)")
);

test/template-function(
  module("getent")
  subject("passwd.lookup-fail")
  description("$$(getent passwd) fails when lookup fails")
  template("$(getent passwd -1) $(getent passwd *)")
);

test/template-function(
  module("getent")
  subject("passwd.invalid-member")
  description("$$(getent passwd) fails when requesting an invalid member")
  template("$(getent passwd 0 whatever)")
);

test/template-function(
  module("getent")
  subject("group")
  description("$$(getent group) works")
  template("$(getent group 0) $(getent group root) $(getent group 0 gid)")
);

test/template-function(
  module("getent")
  subject("group.lookup-fail")
  description("$$(getent group) fails when lookup fails")
  template("$(getent group -1) $(getent group *)")
);

test/template-function(
  module("getent")
  subject("group.invalid-member")
  description("$$(getent group) fails when requesting an invalid member")
  template("$(getent group 0 whatever)")
);
