@define tmpdir "`SNG_TMPDIR`"

source s_internal { internal(); };

block root test/template-function(
      module()
      subject()
      description()
      template()) {
  log {
    source { unix-stream("`tmpdir`/`module`.`subject`.sock"
                         flags(expect-hostname)); };
    destination {
      file("`tmpdir`/`module`.`subject`.log"
           template("# `description`\n`template`\n"));
    };
  };
  log {
    source(s_internal);
    destination {
      file("`tmpdir`/`module`.`subject`.internal.log"
           template("$MESSAGE\n"));
    };
  }
};

block root test/source-driver(
      source()
      module()
      description()
      subject()
      template("$PROGRAM[$PID]: $MESSAGE")) {
  log {
    source { `source`; };
    destination {
      file("`tmpdir`/`module`.`subject`.log"
      template("# `description`\n`template`\n"));
    };
  }
};
